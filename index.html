<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Login Redirect</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; background-color: #f4f4f4; }
        .container { background: white; padding: 20px; border-radius: 10px; display: inline-block; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 90%; max-width: 400px; }
        #userInfo { display: none; }
        img { border-radius: 50%; width: 80px; margin-bottom: 10px; }
        button { padding: 12px 24px; font-size: 16px; cursor: pointer; background-color: #4285F4; color: white; border: none; border-radius: 5px; width: 100%; margin-top: 10px;}
        button:hover { background-color: #357ae8; }
        #logoutBtn { background-color: #ff4444; }
        p { font-size: 14px; color: #555; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Google সাইন-ইন</h2>
        <p id="status">লোডিং হচ্ছে...</p>

        <!-- লগিন বাটন -->
        <button id="loginBtn" style="display:none;">Google দিয়ে লগিন করুন</button>

        <!-- লগিন করার পর যা দেখাবে -->
        <div id="userInfo">
            <img id="userPhoto" src="" alt="User Photo">
            <h3 id="userName"></h3>
            <p id="userEmail"></p>
            <button id="logoutBtn">লগ আউট</button>
        </div>
    </div>

    <!-- ফায়ারবেস স্ক্রিপ্ট -->
    <script type="module">
        // Popup এর বদলে Redirect ইমপোর্ট করা হলো
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithRedirect, signOut, onAuthStateChanged, getRedirectResult } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAtfjaSSlaDYUsogHrvBn_6MbEbM-M-O4Q",
            authDomain: "test-g-login-nur.firebaseapp.com",
            projectId: "test-g-login-nur",
            storageBucket: "test-g-login-nur.firebasestorage.app",
            messagingSenderId: "19016505156",
            appId: "1:19016505156:web:72b1480a444317853f6911",
            measurementId: "G-QX5D57GRX8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const loginBtn = document.getElementById("loginBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const userInfo = document.getElementById("userInfo");
        const userName = document.getElementById("userName");
        const userEmail = document.getElementById("userEmail");
        const userPhoto = document.getElementById("userPhoto");
        const statusTxt = document.getElementById("status");

        // ১. লগিন বাটনে ক্লিক করলে (Redirect হবে)
        loginBtn.addEventListener("click", () => {
            statusTxt.innerText = "গুগল পেজে নেওয়া হচ্ছে...";
            signInWithRedirect(auth, provider);
        });

        // ২. লগ আউট ফাংশন
        logoutBtn.addEventListener("click", () => {
            signOut(auth).then(() => {
                alert("লগ আউট সফল!");
                location.reload(); // পেজ রিফ্রেশ হবে
            }).catch((error) => {
                console.error(error);
            });
        });

        // ৩. পেজ লোড হওয়ার পর রিডাইরেক্ট রেজাল্ট চেক করা (যদি কোনো এরর থাকে)
        getRedirectResult(auth)
            .then((result) => {
                if (result) {
                    console.log("রিডাইরেক্ট সফল:", result.user);
                }
            })
            .catch((error) => {
                console.error(error);
                alert("লগিন সমস্যা: " + error.message);
                statusTxt.innerText = "সমস্যা: " + error.message;
            });

        // ৪. ইউজার স্ট্যাটাস চেক করা
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // লগিন অবস্থায়
                loginBtn.style.display = "none";
                userInfo.style.display = "block";
                statusTxt.style.display = "none";
                
                userName.innerText = user.displayName;
                userEmail.innerText = user.email;
                userPhoto.src = user.photoURL;
            } else {
                // লগিন ছাড়া অবস্থায়
                loginBtn.style.display = "block";
                userInfo.style.display = "none";
                statusTxt.innerText = "লগিন করতে নিচের বাটনে চাপুন";
            }
        });
    </script>

</body>
</html>
